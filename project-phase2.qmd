---
title: "Assessing climate risks impact on green technology innovation"
author: "Louise Cazalet and Esteban Marianadin"
format: html
editor: visual
---

**Link to our Github project :** https://github.com/esteban-mrnd/dm-project.git

## Research Question

dire ce que c'est regions/TL2

## Description and links of the sources

All the following links include the filters we used to get the data for our analysis.

- **Total and green patents** : https://data-explorer.oecd.org/vis?lc=en&tm=-%20regions&pg=0&snb=315&vw=tb&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_REG_PAT%40DF_PAT&df[ag]=OECD.CFE.EDS&df[vs]=1.0&dq=A.TL2....APPLICATION.PAT.._T%2BENV.PATN&pd=1995%2C2022&to[TIME_PERIOD]=false

This OECD dataset provides statistics on patents applications for large regions (TL2). It includes all international patent applications filed under the Patent Cooperation Treaty (PCT) with the World Intellectual Property Organization (WIPO). 


- **Wildfires** : https://data-explorer.oecd.org/vis?lc=en&tm=-%20regions&pg=0&snb=315&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_REG_CLIM%40DF_FIRES&df[ag]=OECD.CFE.EDS&df[vs]=2.4&dq=A.TL2...FIRE.....PT_AR&pd=2000%2C2023&to[TIME_PERIOD]=false&vw=tb

This dataset provides indicators on exposure to wildfires in large regions. According to the OECD, this indicator is derived from the European Joint Research Centre Global wildfire dataset, which captures fire activity and behaviour.It is measured as the percentage of the region's area exposed to wildfire. 

- **Heat stress** :  https://data-explorer.oecd.org/vis?lc=en&tm=-%20regions&pg=20&snb=315&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_REG_CLIM%40DF_HEAT_STRESS&df[ag]=OECD.CFE.EDS&df[vs]=2.4&dq=A.TL2...UTCI_POP_EXP..GE38...&pd=1981%2C2024&to[TIME_PERIOD]=false

This dataset provides statistics on population exposure to heat stress in large regions. According to the OECD, heat stress is estimated using the Universal Thermal Comfort Index (UTCI). The UTCI enables to assess the impact of atmospheric conditions on the human body by considering air temperature, wind, radiation and humidity. UTCI values from 32°C to 38°C are considered as strong heat stress, from 38°C to 46°C as very strong heat stress, and above 46°C as extreme heat stress. Population exposure to heat stress was computed using the hourly thermal comfort indices grids from the Copernicus Climate Data Store.For this project, we choose to take the number of days in a given year during which a region experienced temperatures exceeding 38°C.


- **GDP per capita per regions** : https://data-explorer.oecd.org/vis?lc=en&tm=-%20regions&pg=20&snb=315&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_REG_ECO%40DF_GDP&df[ag]=OECD.CFE.EDS&df[vs]=2.0&dq=A.TL2...GDP..Q.USD_PPP_PS&pd=1995%2C2023&to[TIME_PERIOD]=false

This dataset provides information on gross domestic product (GDP) per capita for large  regions. Data are collected at current prices (in millions of national currency) from Eurostat for EU countries, from OECD Working Party on Territorial Indicators (WPTI) delegates, and from national statistical offices. To ensure comparability over time and across countries, GDP values are converted into constant prices and purchasing power parity (PPP). It is calculated by dividing regional GDP by the region’s average annual population. and is expressed in US dollars per person.

- **Health risks** : https://data-explorer.oecd.org/vis?lc=en&tm=regions&pg=20&snb=315&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_REG_HEALTH%40DF_RISK&df[ag]=OECD.CFE.EDS&df[vs]=2.0&dq=A....PM25_POP_EXP...&to[TIME_PERIOD]=false&pd=1995%2C2020

This OECD dataset provides statistics on health risks for large regions (TL2). For this project, we focus on population exposure to fine particulate matter (PM2.5) as an indicator of air pollution. PM2.5 exposure represents the population-weighted average concentration of fine particulate matter with a diameter of 2.5 microns or less. These indicators are computed using geospatial data from the Global Burden of Disease (GBD) 2019 project.

- **R&D expenditures** : https://data.worldbank.org/indicator/GB.XPD.RSDV.GD.ZS

This World Bank dataset provides statistics on gross domestic expenditure on research and development (R&D) as a percentage of GDP. It includes both capital and current expenditures in the business, government, higher education, and private non-profit sectors. R&D covers basic research, applied research, and experimental development. The data are compiled by the UNESCO Institute for Statistics (UIS) and are available annually. The unit of measure is the percentage of GDP.

### Short description of the project

### Data Import

```{r}
library(vroom)
library(here)
library(dplyr)
library(tidyr)
here::i_am("dm-project.Rproj")
```

```{r}
patents <- vroom(here("data","patents.csv"))
gdp_regions <- vroom(here("data","gdp_regions.csv"))
precipitation <- vroom(here("data","extreme_precipitations.csv"))
health_risks <- vroom(here("data","health_risks.csv"))
heat_stress <- vroom(here("data","heat_stress.csv"))
wildfires <- vroom(here("data","wildfires.csv"))
rd_exp_country <- vroom(here("data","rd-exp-country.csv"))

```

```{r}
rd_exp_country <- as.data.frame(rd_exp_country)

library(dplyr)
library(tidyr)

# Supposons que ton df s'appelle rd_exp_raw
# 1️⃣ Garder seulement les lignes de données (à partir de la ligne 4)
rd_exp_clean <- rd_exp_country[4:nrow(rd_exp_country), ]

# 2️⃣ Renommer les colonnes
colnames(rd_exp_clean)[1:4] <- c("CountryName", "CountryCode", "IndicatorName", "IndicatorCode")

# 3️⃣ Convertir les colonnes années en format long
rd_long <- rd_exp_clean %>%
  pivot_longer(
    cols = 5:ncol(rd_exp_clean),  # colonnes des années
    names_to = "Year",
    values_to = "R&D_expenditure"
  ) %>%
  mutate(
    Year = as.integer(as.numeric(Year))  # enlever .0000000
  )

# 4️⃣ Maintenant rd_long est prêt pour merge

regional_df <- regional_df %>%
  rename(CountryCode = Country, Year = <colonne_année>) %>%
  mutate(Year = as.integer(Year))

merged_df <- regional_df %>%
  left_join(rd_long, by = c("CountryCode", "Year"))


```

### Data description

```{r}
summarize_data <- function(df) {
  df |> summarize(
    `Number of lines` = n(),
    `Number of columns` = ncol(df),
    start_year = min(df[["TIME_PERIOD"]], na.rm = TRUE),
    end_year   = max(df[["TIME_PERIOD"]], na.rm = TRUE)
  )
}


summarize_data(patents)
summarize_data(gdp_regions)
summarize_data(precipitation)
summarize_data(health_risks)
summarize_data(heat_stress)
summarize_data(wildfires)
```

### Key Variable : share of green patent

#### Clean patents and create final database

```{r}
df <- patents |>
  select(REF_AREA,`Zone de référence`, TIME_PERIOD, COUNTRY, Pays, OBS_VALUE, `Sélection de domaines technologiques de l'OCDE`)


df <- df|>
  pivot_wider(
    names_from = `Sélection de domaines technologiques de l'OCDE`,
    values_from = OBS_VALUE
  )

df <- df |>
  rename(
    green_patents = `Technologies liées à l'environment`,
    total_patents = `Total des brevets`
  )

df<- df |>
  left_join(
    gdp_regions |> select(REF_AREA, TIME_PERIOD, OBS_VALUE),
    by = c("REF_AREA", "TIME_PERIOD")
  ) |>
  rename(gdp_region=OBS_VALUE)

df<- df |>
  left_join(
    health_risks|> select(REF_AREA, TIME_PERIOD, OBS_VALUE),
    by = c("REF_AREA", "TIME_PERIOD")
  ) |>
  rename(pollution_expos=OBS_VALUE)

df<- df |>
  left_join(
    heat_stress|> select(REF_AREA, TIME_PERIOD, OBS_VALUE),
    by = c("REF_AREA", "TIME_PERIOD")
  ) |>
  rename(heat_stress=OBS_VALUE)

df<- df |>
  left_join(
    precipitation|> select(REF_AREA, TIME_PERIOD, OBS_VALUE),
    by = c("REF_AREA", "TIME_PERIOD")
  ) |>
  rename(precipitation=OBS_VALUE)

df<- df |>
  left_join(
    wildfires|> select(REF_AREA, TIME_PERIOD, OBS_VALUE),
    by = c("REF_AREA", "TIME_PERIOD")
  ) |>
  rename(wildfire=OBS_VALUE)


```
